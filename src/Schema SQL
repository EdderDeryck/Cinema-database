-- Distribuidores
CREATE TABLE IF NOT EXISTS distributors (
    distributor_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    country VARCHAR(50),
    contact_phone VARCHAR(20)
);

-- Gêneros
CREATE TABLE IF NOT EXISTS genres (
    genre_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL
);

-- Cinemas
CREATE TABLE IF NOT EXISTS cinema (
    cinema_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    city VARCHAR(50),
    state VARCHAR(50),
    address VARCHAR(150)
);

-- Filmes
CREATE TABLE IF NOT EXISTS movies (
    movie_id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(150) NOT NULL,
    release_date DATE,
    duration_minutes INT,
    distributor_id INT,
    genre_id INT,
    FOREIGN KEY (distributor_id) REFERENCES distributors(distributor_id),
    FOREIGN KEY (genre_id) REFERENCES genres(genre_id)
);

-- Restrições de filmes
CREATE TABLE IF NOT EXISTS movie_restrictions (
    movie_id INT PRIMARY KEY,
    age_limit INT,
    explanation VARCHAR(255),
    FOREIGN KEY (movie_id) REFERENCES movies(movie_id) ON DELETE CASCADE
);

-- Salas
CREATE TABLE IF NOT EXISTS halls (
    hall_id INT AUTO_INCREMENT PRIMARY KEY,
    cinema_id INT,
    hall_number INT,
    capacity INT,
    FOREIGN KEY (cinema_id) REFERENCES cinema(cinema_id)
);

-- Sessões
CREATE TABLE IF NOT EXISTS showings (
    showing_id INT AUTO_INCREMENT PRIMARY KEY,
    movie_id INT,
    hall_id INT,
    show_date DATE,
    show_time TIME,
    price DECIMAL(8,2),
    FOREIGN KEY (movie_id) REFERENCES movies(movie_id),
    FOREIGN KEY (hall_id) REFERENCES halls(hall_id)
);

-- Promoções
CREATE TABLE IF NOT EXISTS promotions (
    promotion_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    discount_percent INT,
    start_date DATE,
    end_date DATE
);

-- Promoções aplicadas às sessões
CREATE TABLE IF NOT EXISTS showing_promotions (
    showing_id INT,
    promotion_id INT,
    PRIMARY KEY (showing_id, promotion_id),
    FOREIGN KEY (showing_id) REFERENCES showings(showing_id) ON DELETE CASCADE,
    FOREIGN KEY (promotion_id) REFERENCES promotions(promotion_id) ON DELETE CASCADE
);

-- Usuários
CREATE TABLE IF NOT EXISTS users (
    users_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Funcionários
CREATE TABLE IF NOT EXISTS employees (
    employees_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100),
    cinema_id INT,
    hire_date DATE,
    role VARCHAR(50),
    FOREIGN KEY (cinema_id) REFERENCES cinema(cinema_id)
);

-- Ingressos
CREATE TABLE IF NOT EXISTS tickets (
    ticket_id INT AUTO_INCREMENT PRIMARY KEY,
    showing_id INT,
    user_id INT,
    seat_number VARCHAR(10),
    purchase_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (showing_id) REFERENCES showings(showing_id),
    FOREIGN KEY (user_id) REFERENCES users(users_id)
);

-- Pagamentos
CREATE TABLE IF NOT EXISTS payments (
    payment_id INT AUTO_INCREMENT PRIMARY KEY,
    ticket_id INT UNIQUE,
    payment_method VARCHAR(50),
    paid_value DECIMAL(8,2),
    paid_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ticket_id) REFERENCES tickets(ticket_id) ON DELETE CASCADE
);

-- Reviews
CREATE TABLE IF NOT EXISTS reviews (
    review_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    movie_id INT,
    rating INT,
    comment VARCHAR(255),
    review_date DATE,
    FOREIGN KEY (user_id) REFERENCES users(users_id),
    FOREIGN KEY (movie_id) REFERENCES movies(movie_id)
);

-- Filmes e múltiplos gêneros (n:n)
CREATE TABLE IF NOT EXISTS movie_genres (
    movie_id INT,
    genre_id INT,
    PRIMARY KEY (movie_id, genre_id),
    FOREIGN KEY (movie_id) REFERENCES movies(movie_id) ON DELETE CASCADE,
    FOREIGN KEY (genre_id) REFERENCES genres(genre_id) ON DELETE CASCADE
);

INSERT INTO cinema (cinema_id, name, city, state, address) VALUES
(1, 'CineMax', 'São Paulo', 'SP', 'Rua A, 123'),
(2, 'MoviePalace', 'Rio de Janeiro', 'RJ', 'Avenida B, 456'),
(3, 'StarCinema', 'Belo Horizonte', 'MG', 'Praça C, 789');

INSERT INTO halls (hall_id, cinema_id, hall_number, capacity) VALUES
(1, 1, 1, 100),
(2, 1, 2, 120),
(3, 2, 1, 80),
(4, 3, 1, 90);

INSERT INTO distributors (distributor_id, name, country, contact_phone) VALUES
(1, 'Marvel Studios', 'USA', '+1 555-1234'),
(2, 'Warner Bros', 'USA', '+1 555-5678'),
(3, 'Disney', 'USA', '+1 555-9012');

INSERT INTO genres (genre_id, name) VALUES
(1, 'Action'),
(2, 'Sci-Fi'),
(3, 'Animation');

INSERT INTO movies (movie_id, title, release_date, duration_minutes, distributor_id, genre_id) VALUES
(1, 'Avengers', '2012-05-04', 150, 1, 1),
(2, 'Inception', '2010-07-16', 148, 2, 2),
(3, 'The Lion King', '1994-06-24', 88, 3, 3);

INSERT INTO movie_genres (movie_id, genre_id) VALUES
(1, 1), 
(2, 2), 
(3, 3); 

INSERT INTO movie_restrictions (movie_id, age_limit, explanation) VALUES
(1, 13, 'Violence and mild language'),
(2, 16, 'Complex themes and action sequences'),
(3, 0, 'Suitable for all ages');

INSERT INTO showings (showing_id, movie_id, hall_id, show_date, show_time, price) VALUES
(1, 1, 1, '2025-11-15', '18:00:00', 30.00),
(2, 2, 2, '2025-11-15', '20:00:00', 35.00),
(3, 3, 3, '2025-11-15', '14:00:00', 25.00);

INSERT INTO promotions (promotion_id, name, discount_percent, start_date, end_date) VALUES
(1, 'Weekend Special', 20, '2025-11-01', '2025-11-30'),
(2, 'Student Discount', 15, '2025-11-01', '2025-12-31');

INSERT INTO showing_promotions (showing_id, promotion_id) VALUES
(1, 1),
(2, 2);

INSERT INTO users (users_id, name, email, phone) VALUES
(1, 'Alice', 'alice@email.com', '11999990001'),
(2, 'Bob', 'bob@email.com', '11999990002'),
(3, 'Charlie', 'charlie@email.com', '11999990003');

INSERT INTO employees (employees_id, name, cinema_id, hire_date, role) VALUES
(1, 'Daniel', 1, '2022-01-10', 'Manager'),
(2, 'Eva', 2, '2023-03-15', 'Cashier');

INSERT INTO tickets (ticket_id, showing_id, user_id, seat_number) VALUES
(1, 1, 1, 'A1'),
(2, 2, 2, 'B2');

INSERT INTO payments (payment_id, ticket_id, payment_method, paid_value) VALUES
(1, 1, 'Credit Card', 30.00),
(2, 2, 'Cash', 35.00);

INSERT INTO reviews (review_id, user_id, movie_id, rating, comment, review_date) VALUES
(1, 1, 1, 5, 'Amazing movie!', '2025-11-10'),
(2, 2, 2, 4, 'Great mind-bending film.', '2025-11-11');